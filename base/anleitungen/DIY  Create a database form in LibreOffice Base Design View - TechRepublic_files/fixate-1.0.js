define(["jquery","version!fly/components/base"],function(e){e.widget("fly.fixate",e.fly.base,{options:{classFixed:"fixed",classUnfixed:"unfixed",primaryEdge:"top",offset:{top:20,bottom:20},stickToLeft:!1,stickToRight:!1,guideTop:null,guideBottom:null,guideLeft:null,guideRight:null},hasEvents:!1,isFixed:!1,boundary:{top:-1,bottom:-1,left:-1,right:-1},$element:null,$window:e(window),$document:e(document),_create:function(){this._super("_create"),this._setBoundaries(),this._addEvents(),this.checkPosition()},_addEvents:function(){var t=this.options;if(this.hasEvents||this.disabled)return;this.hasEvents=!0,this.$window.on("scroll.fixate",e.proxy(this.checkPosition,this)),this.$window.on("resize.fixate",e.proxy(this.checkPosition,this))},_removeEvents:function(){this.hasEvents=!1},_setBoundaries:function(){var t=this.options,n=null;this.boundary={top:-1,bottom:-1,left:-1,right:-1},t.guideTop&&(t.guideTop=e(t.guideTop),n=t.guideTop.offset(),this.boundary.top=n.top+t.guideTop.outerHeight()),t.guideBottom&&(t.guideBottom=e(t.guideBottom),n=t.guideBottom.offset(),this.boundary.bottom=n.top);if(t.guideLeft){t.guideLeft=e(t.guideLeft),n=t.guideLeft.offset();if(t.stickToLeft){if(this.boundary.top<0||n.top>this.boundary.top)this.boundary.top=n.top;if(this.boundary.bottom<0||n.top+t.guideLeft.outerHeight()<this.boundary.bottom)this.boundary.bottom=n.top+t.guideLeft.outerHeight()}}if(t.guideRight){t.guideRight=e(t.guideRight),n=t.guideRight.offset();if(t.stickToRight){if(this.boundary.top<0||n.top>this.boundary.top)this.boundary.top=n.top;if(this.boundary.bottom<0||n.top+t.guideRight.outerHeight()<this.boundary.bottom)this.boundary.bottom=n.top+t.guideRight.outerHeight()}}},_fix:function(){var e=this.options;this.isFixed=!0,this.$element.addClass(e.classFixed).removeClass(e.classUnfixed),e.primaryEdge==="top"?this.$element.css("top",e.offset.top):this.$element.css("top",this.$window.height()-e.offset.bottom-this.$element.height()),this._placeHorizontally()},_unfix:function(e){var t=this.options;this.isFixed=!1,this.$element.addClass(t.classUnfixed).removeClass(t.classFixed),e==="top"?this.$element.css("top",this.boundary.top+t.offset.top-this.$window.scrollTop()):this.$element.css("top",this.boundary.bottom-t.offset.bottom-this.$element.height()-this.$window.scrollTop()),this._placeHorizontally()},_placeHorizontally:function(){var e=this.options,t=this.$window.scrollLeft();e.guideLeft?this.$element.css("left",e.guideLeft.offset().left+e.guideLeft.outerWidth()-t):e.guideRight&&this.$element.css("left",e.guideRight.offset().left-this.$element.width()-t)},checkPosition:function(){var e=this.options,t=this.$window.scrollTop(),n=t+this.$window.height(),r=this.$element.height();this._setBoundaries(),e.primaryEdge==="top"?t<this.boundary.top?this._unfix("top"):this.boundary.bottom>=0&&t+e.offset.top+r+e.offset.bottom>this.boundary.bottom?this._unfix("bottom"):this._fix():n>this.boundary.bottom?this._unfix("bottom"):n-e.offset.bottom-r-e.offset.top<this.boundary.top?this._unfix("top"):this._fix()},destroy:function(){this._removeEvents(),this._super("destroy")}})})